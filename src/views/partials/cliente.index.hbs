<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listado de Clientes</title>

    <link rel="stylesheet" href="/css/fonta-all.min.css">
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="icon" href="/icon/icon1.png">

</head>
<body>
    <header>
        <nav>
            {{> nav }}
        </nav>
    </header>
    <main style="display: flex; height: 95vh ; width: 95vw;">
        <nav style="background-color: black;" >
            {{> cliente.menu }}
        </nav>
        <section style="margin-left: 5vw; margin-top:2vw; height: 100%; width: 80%;" >
            <div class="container-xxl">
                
                <h3>Clientes registrados</h3>
                
                <table id="tablaClientes" class="table table-hover" style="width:50vw ; height: auto;"  >
                    <thead>
                        <tr class="table-dark">
                        <th scope="col">Id</th>
                        <th scope="col">Nombre</th>
                        <th scope="col">NIT</th>
                        <th scope="col">dirección</th>
                        <th scope="col">telefono</th>
                        <th scope="col" >Email</th>
                        <th scope="col">Tipo Cliente</th>
                        <th scope="col">Opciones</th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
            
        </section>

    </main>
    <footer>

    </footer>

<script type="text/javascript" language="javascript" src="/DataTables/jQuery-3.6.0/jquery-3.6.0.js"></script>
<script type="text/javascript" language="javascript" src="/DataTables/DataTables-1.12.1/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" language="javascript" src="/DataTables/dataTables.bootstrap5.min.js"></script>
    
<script src="/js/sweetalert2@11.js"></script>

<script>

    $(document).ready(() => {
        var url = 'http://localhost:4000/api/clientes';

        $('#tablaClientes').DataTable ({

            "language": {
                "url": "/DataTables/es-MX.json"
            },

            "ajax":{
                    "url": url,
                    "dataSrc":""
            },
            "columns": [
            {"data" : "id"},
            {"data" : "nombre"},
            {"data" : "nit"},
            {"data" : "direccion"},
            {"data" : "telefono"},
            {"data" : "email"},
            {"data" : "tipoClienteId"},
            {"data" : function(data){
            return '<a href="#"> <button type="button" class="btn btn-warning">Ediar</button></a><button type="button" class="btn btn-danger" onclick="eliminar('+data.id+')">Eliminar</button>'}
            }
            ],

        });

    });

    function eliminar(id){

        Swal.fire({
            title: 'Desea Eliminar el usuario '+ id +'?',
            text: "Esta accion no se puede revertir!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Sí, borrar usuario!'
        }).then((result) => {
        if (result.isConfirmed) {

            fetch('/api/delete-cliente/'+ id,{
            method: 'delete',
            })
            .then((res)=>{

            Swal.fire(
            'Borrado!',
            'Cliente eliminado Exitosamente !!!',
            'success'
            )
            res.json()
            
            })
            .catch(err => {
            Swal.fire({
                icon: 'Error',
                title: 'Oops...',
                text: 'Error al eliminar Cliente !',
                footer: '<a href="">Por qué aparece el error?</a>'
            })
            console.log(err)
            
            });
        }
        })

        
    }

   

</script>

</body>
</html>